(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1def79de"],{"1ccd":function(e,t,a){},"2b4a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"view-wrapper",style:{height:e.pageMixin_browser.clientHeight}},[a("DP_Popup",{attrs:{display:e.popup.show,"show-close":!0,"background-color":"white",title:e.popup.title},on:{"update:display":function(t){return e.$set(e.popup,"show",t)}}},[a("img",{staticClass:"qrcode",attrs:{src:e.pageQrcode_img,alt:""}}),a("div",[e._v("请打开微信扫一扫")])]),a("div",{staticClass:"content"},[e.userInfo.avatar?a("img",{ref:"avatar",staticClass:"avatar",attrs:{width:"100px",crossorigin:"anonymous",src:e.userInfo.avatar,alt:""}}):e._e(),[a("div",{ref:"posterWrapper",staticClass:"poster-wrapper"},[a("img",{directives:[{name:"show",rawName:"v-show",value:e.output_img,expression:"output_img"}],ref:"poster_output",staticClass:"poster_output",attrs:{src:e.output_img,alt:""}}),a("img",{directives:[{name:"show",rawName:"v-show",value:!e.output_img,expression:"!output_img"}],ref:"poster",staticClass:"origin",attrs:{crossorigin:"anonymous",src:e.pageParameter.posterAndShareContent.length>0?e.pageParameter.posterAndShareContent[0].url:"",alt:""}}),a("canvas",{ref:"canvas",attrs:{id:"canvas"}})])],""===e.output_img?a("div",{staticClass:"in-development"},[e._v(e._s(e.tips))]):e._e()],2),e.pageMixin_browser.device.isDPApp&&e.output_img?a("div",{staticClass:"share-in-app"},[a("div",{staticClass:"option-wrapper"},[a("a",{staticClass:"option",attrs:{href:"uniwebview://wechatsharetofriend?image="+e.output_img}},[a("div",{staticClass:"icon friend"}),a("div",{staticClass:"label"},[e._v("微信")])]),a("a",{staticClass:"option",attrs:{href:"uniwebview://wechatsharetomoments?image="+e.output_img}},[a("div",{staticClass:"icon moment"}),a("div",{staticClass:"label"},[e._v("朋友圈")])]),a("a",{staticClass:"option"},[a("div",{staticClass:"icon scan",on:{click:e.openPopup}}),a("div",{staticClass:"label"},[e._v("扫码")])])])]):e._e(),e.pageMixin_browser.device.isWechat&&e.output_img?a("div",{staticClass:"share-in-wechat"},[a("div",{staticClass:"arrow"}),a("div",{staticClass:"tips"},[e._v("长按上图保存到相册，分享给好友")])]):e._e()],1)},s=[],i=(a("b0c0"),a("d3b7"),a("96cf"),a("1da1")),n=a("5530"),o=a("f586"),c=a("fb04"),u=a("2f62"),p=a("41d1"),m={metaInfo:function(){return{title:this.$route.meta.title||"熊猫博士",meta:[{name:"keywords",content:this.$route.meta.title+",熊猫博士"}]}},name:"index",components:{DP_Popup:p["a"]},mixins:[o["a"]],props:{},data:function(){return{tips:"海报制作中，请稍后...",posterData:[],showImg:!1,output_img:"",p_img:!1,a_img:!1,qrcode:"",pageQrcode_img:"",popup:{show:!1,title:""}}},watch:{},computed:Object(n["a"])({},Object(u["b"])({pageParameter:"getPageParameter",userInfo:"getUserInfo"})),methods:{openPopup:function(){this.popup.show=!0},draw:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,s,n,o,u,p;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=window.devicePixelRatio,console.log("window.devicePixelRatio",a),r=e.$route.query.user_id?e.$route.query.user_id:e.userInfo.id,r){t.next=7;break}return e.tips="用户信息错误",e.showImg=!1,t.abrupt("return");case 7:return t.next=9,Object(c["d"])(r);case 9:s=t.sent,n=s.data,o=n.data,u=n.code,p=new Image,0===u&&(p.src="data:image/jpeg;base64,"+o),p.onload=Object(i["a"])(regeneratorRuntime.mark((function t(){var a,r,s,i,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getImg("poster");case 2:if(a=t.sent,r=e.$refs.canvas,s=640,i=1138,r.width=s,r.height=i,n=r.getContext("2d"),!e.$store.getters.getBrowser.device.isWechat||!e.userInfo.avatar){t.next=24;break}return t.next=12,e.getImg("avatar");case 12:o=t.sent,n.drawImage(a,0,0,s,i),n.fillStyle="white",n.font="22px Helvetica, Arial, sans-serif",n.fillText(e.userInfo.name,130,65),n.font="18px Helvetica, Arial, sans-serif",n.fillText(e.pageParameter.posterAndShareContent[0].shareContent,130,95),n.drawImage(o,30,30,80,80),n.drawImage(p,430,936,150,150),e.output_img=r.toDataURL(),t.next=30;break;case 24:n.drawImage(a,0,0,s,i),n.fillStyle="white",n.font="22px Helvetica, Arial, sans-serif",n.fillText(e.pageParameter.posterAndShareContent[0].shareContent,30,65),n.drawImage(p,430,936,150,150),e.output_img=r.toDataURL();case 30:case"end":return t.stop()}}),t)})));case 14:case"end":return t.stop()}}),t)})))()},getPageQrCode:function(){var e=this;Object(c["c"])("com.drpanda.chineseacademy",!0).then((function(t){var a=t.data,r=a.data,s=a.code;0===s&&(e.pageQrcode_img="data:image/jpeg;base64,"+r)}))},getImg:function(e){var t=this,a=this.$refs[e];return new Promise((function(e,r){a.complete?(e(a),console.log("图片加载已完成")):(a.onload=function(){e(a)},a.onerror=function(){t.dp_Tips("提示","海报加载错误 请重试"),r("图片加载失败")},a.onabort=function(){t.dp_Tips("提示","海报加载失败 请重试"),r("图片取消加载")})}))},getData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("getPageParameter",{disableLoading:!0});case 2:a=t.sent,a&&(e.posterData=e.pageParameter.posterAndShareContent,setTimeout((function(){e.draw()}),500));case 4:case"end":return t.stop()}}),t)})))()}},created:function(){var e=this;this.getPageQrCode(),setTimeout((function(){var t=e.pageMixin_jsSdk;t&&t.hideMenuItems({menuList:["menuItem:share:appMessage","menuItem:share:timeline","menuItem:share:qq","menuItem:share:weiboApp","menuItem:share:favorite","menuItem:share:facebook","menuItem:share:QZone","menuItem:favorite","menuItem:copyUrl","menuItem:openWithQQBrowser","menuItem:openWithSafari"]})}),1500)},mounted:function(){var e=this;this.pageMixin_setRequestCompleted(!0),this.pageParameter.isInit?this.getData():setTimeout((function(){e.draw()}),500),setTimeout((function(){}),500)}},d=m,l=(a("d156"),a("2877")),g=Object(l["a"])(d,r,s,!1,null,"20cd3dff",null);t["default"]=g.exports},d156:function(e,t,a){"use strict";var r=a("1ccd"),s=a.n(r);s.a}}]);
//# sourceMappingURL=chunk-1def79de.20037f3b.js.map