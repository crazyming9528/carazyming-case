webpackJsonp([6],{O3Ek:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("RAp7"),s=n("/6my"),i=n("STSY"),r=n("vZz+"),o={name:"RoleModify",components:{TableToolsBox:s.a},mixins:[a.a],props:{},data:function(){return{rid:this.$route.query.rid,vueRoutes:null,form:{roleName:"",description:""},permissionUpdate:{menu:[],api:[]},allPermission:[],menuPermission:[],currentMenu:{title:"",name:""},treeProps:{label:function(e,t){return e.meta.title},children:"children"},tree:null,apiPermission:[]}},watch:{},computed:{},methods:{getRoutes:function(){var e=this;Object(r.c)().then(function(t){var n=t.data,a=n.data,s=n.code;n.message;if(1e4===s){var i=a.map(function(e){return e.menu_key});e.vueRoutes=_.cloneDeep(e.$router.options.routes.find(function(e){return"Frame"===e.name}).children),e.tree=function e(t){return t.filter(function(t){return t.children&&(t.children=e(t.children)),i.includes(t.name)})}(e.vueRoutes)}})},getRoleInfoFn:function(){var e=this;this.rid&&Object(i.b)(this.rid).then(function(t){var n=t.data,a=n.data,s=n.code;n.message;1e4===s&&(e.form.roleName=a.role_name,e.form.description=a.description,e.allPermission=a.permission,e.menuPermission=a.permission.map(function(e){return e.menu_key}))})},handleMenuCheckChange:function(e,t,n){console.log(arguments);var a=this.permissionUpdate.menu.find(function(t){return t.name===e.name});a?a.status=t:this.permissionUpdate.menu.push({name:e.name,status:t})},handleApiCheckChange:function(e,t,n){n=n[0],console.log(e,t,n);var a=this.permissionUpdate.api.find(function(n){return n.key===t&&n.menu_key===e});a?a.status=n:this.permissionUpdate.api.push({key:t,menu_key:e,status:n})},handleNodeClick:function(e){var t=this;this.currentMenu={title:e.meta.title,name:e.name};var n=e.name;Object(r.b)(n).then(function(e){var a=e.data,s=a.code,i=a.data;a.message;if(1e4===s){t.apiPermission=i.map(function(e){return{key:e.key,name:e.description,checked:!1}});var r=t.allPermission.find(function(e){return e.menu_key===n});console.log(r,n),r&&"api"in r&&t.apiPermission.forEach(function(e){console.log(e),r.api.find(function(t){return t.key===e.key})&&(e.checked=!0)})}})},saveData:function(){var e=this;Object(i.c)(this.rid,{base:this.form,permission:this.permissionUpdate}).then(function(t){var n=t.data,a=(n.data,n.code),s=n.message;1e4===a&&e.ele_alert(s,"success",function(){e.globalMixin_goBack()})})}},created:function(){this.getRoutes(),this.getRoleInfoFn()},mounted:function(){}},c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page_wrapper"},[n("div",{staticClass:"main_body animated  fadeIn"},[n("el-row",{staticClass:"head_area  panel_area"},[n("el-col",{attrs:{span:24}},[n("span",{staticClass:"title"},[e._v("角色修改")]),e._v(" "),n("span",{staticClass:"description"},[e._v(e._s(this.$store.getters.systemInfo.title)+" 角色修改")]),e._v(" "),n("el-button",{attrs:{plain:"",size:"mini",type:"success"},nativeOn:{click:function(t){return e.getRoutes(t)}}},[e._v("获取")])],1)],1),e._v(" "),n("el-row",{staticClass:"panel_area"},[n("el-col",{attrs:{span:24}},[n("h3",{staticClass:"part_title"},[e._v("角色基础信息修改")])]),e._v(" "),n("el-col",{attrs:{span:24}},[n("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[n("label",{attrs:{for:"name"}},[e._v("角色名称:")]),e._v(" "),n("el-input",{attrs:{id:"name",disabled:1==e.rid},model:{value:e.form.roleName,callback:function(t){e.$set(e.form,"roleName",t)},expression:"form.roleName"}}),e._v(" "),n("label",{staticStyle:{"margin-left":"15px"},attrs:{for:"description"}},[e._v("角色描述:")]),e._v(" "),n("el-input",{staticStyle:{width:"500px"},attrs:{id:"description"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1),e._v(" "),1!=e.rid?n("el-row",{staticClass:"panel_area",attrs:{gutter:20}},[n("el-col",{attrs:{span:24}},[n("h3",{staticClass:"part_title"},[e._v("角色权限修改")])]),e._v(" "),n("el-col",{attrs:{span:8}},[n("h3",[e._v("菜单级别的权限")]),e._v(" "),e.tree?n("div",[n("el-tree",{attrs:{data:e.tree,"default-checked-keys":e.menuPermission,props:e.treeProps,"node-key":"name","show-checkbox":""},on:{"check-change":e.handleMenuCheckChange,"node-click":e.handleNodeClick}})],1):e._e()]),e._v(" "),this.currentMenu.title?n("el-col",{attrs:{span:16}},[n("h3",[n("span",{staticClass:"currentMenu"},[e._v(e._s(this.currentMenu.title))]),e._v(" 菜单下的 具体权限 ")]),e._v(" "),n("div",{staticClass:"api_permission"},e._l(e.apiPermission,function(t,a){return n("el-checkbox",{key:a,on:{change:function(n){return e.handleApiCheckChange(e.currentMenu.name,t.key,arguments)}},model:{value:t.checked,callback:function(n){e.$set(t,"checked",n)},expression:"p.checked"}},[e._v(e._s(t.name)+"\n          ")])}),1)]):n("el-col",{attrs:{span:16}},[n("el-alert",{attrs:{title:"点击左侧菜单节点后可分配具体权限",type:"info"}})],1)],1):n("el-row",{staticClass:"panel_area",attrs:{gutter:20}},[n("el-col",{attrs:{span:24}},[n("h3",{staticClass:"part_title"},[e._v("角色权限修改")])]),e._v(" "),n("el-col",{attrs:{span:24}},[n("el-alert",{attrs:{title:"无法修改超级管理员的权限,超级管理员拥有全部权限！",type:"info"}})],1)],1),e._v(" "),n("el-row",{staticClass:"panel_area form_footer_button"},[n("el-col",{attrs:{span:24}},[n("el-button",{attrs:{type:"primary"},on:{click:e.saveData}},[e._v("保存")]),e._v(" "),n("el-button",{on:{click:e.globalMixin_goBack}},[e._v("返回")])],1)],1)],1)])},staticRenderFns:[]};var l=n("VU/8")(o,c,!1,function(e){n("yGCl")},"data-v-41662a8f",null);t.default=l.exports},"vZz+":function(e,t,n){"use strict";t.c=function(){return Object(a.a)({url:"/getMenuPermission",method:"get"})},t.e=function(e){return Object(a.a)({url:"/setMenuPermission",method:"post",data:{data:e}})},t.b=function(e){return Object(a.a)({url:"/getAPIPermissionByMenu",method:"get",params:{menu:e}})},t.d=function(e){return Object(a.a)({url:"/setAPIPermissionByMenu",method:"post",data:{data:e}})},t.a=function(e){return Object(a.a)({url:"/deleteAPIPermissionByMenu",method:"delete",params:{ap_id:e}})};var a=n("vLgD")},yGCl:function(e,t){}});
//# sourceMappingURL=6.a737a723a86c5d64bed5.js.map